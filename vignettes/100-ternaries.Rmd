---
title: "Ternary plots for Congreve & Lamsdell matrices"
author: "Martin R. Smith"
date: "29 November 2017"
output: rmarkdown::html_document
bibliography: ../inst/REFERENCES.bib
csl: https://raw.githubusercontent.com/citation-style-language/styles/master/systematic-biology.csl
vignette: >
  %\VignetteIndexEntry{Congreve & Lamsdell - individual trees}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

This page depicts the analytical results of all 100 matrices generated by
Congreve & Lamsdell [-@Congreve2016].

```{r initialize, echo=FALSE, fig.width=9, fig.height=90}
library(SlowQuartet)
library(Ternary)
data(clPartitions)
data(clQuartets)
data(clCI)

PCH_MK <- 1 # circle
PCH_EQ <- 61 #'='
PCH_IW <- 2 #triup
TREE <- 2

COL_MK <- cbPalette8[4]
COL_EQ <- cbPalette8[2]
COL_1  <- cbPalette15[6]
COL_2  <- cbPalette15[7]
COL_3  <- cbPalette15[8]
COL_5  <- cbPalette15[9]
COL10  <- cbPalette15[10]

MARGINS <- c(2.8, 0.3, 0.3, 0.3)

Quartet2Ternary <- function (item, TREE) clQuartets[[item]][c('s', 'd', 'r2'), , TREE]
  
Split2Ternary <- function (item, TREE) {
  itemData <- clPartitions[[item]][, , TREE]
  rbind(itemData['cf_and_ref', ],
        itemData['cf_not_ref', ],
        itemData['ref', ] - itemData['cf', ])
}

TernaryQuarts<-function(Func=Quartet2Ternary, TREE=TREE, zoom=1, padding=0.1) {
  
  xLim <- c(0, sqrt(3/4)/zoom)
  yLim <- c(0.5-(1/zoom), 0.5)
  lab <- if (zoom == 1) c('  Same', ' Different', 'Unresolved') else rep('', 3)
  
  TernaryPlot(lab[1], lab[2], lab[3], lab.cex=0.8, lab.font=2,
              grid.lty='solid', col=rgb(0.9, 0.9, 0.9), grid.col='white', 
              grid.lines=7,  axis.labels = 
                if(zoom==1) round(seq(0, choose(22, 4), length.out=8), 0)
                else FALSE,
              axis.col=rgb(0.6, 0.6, 0.6), ticks.col=rgb(0.6, 0.6, 0.6),
              padding=padding, xlim=xLim, ylim=yLim)
  HorizontalGrid()
  AddToTernary(lines, list(c(1/3, 2/3, 0), c(0, 0, 1)), lty='dotted', col=cbPalette8[8], lwd=2)
  
  JoinTheDots(Func('markov'  , TREE=TREE), col=COL_MK, pch=PCH_MK, cex=1.1)
  JoinTheDots(Func('equal'   , TREE=TREE), col=COL_EQ, pch=PCH_EQ, cex=1.1)
  JoinTheDots(Func('implied5', TREE=TREE), col=COL_5,  pch=PCH_IW, cex=1.1)
  JoinTheDots(Func('implied3', TREE=TREE), col=COL_3,  pch=PCH_IW, cex=1.1)
  JoinTheDots(Func('implied1', TREE=TREE), col=COL_1,  pch=PCH_IW, cex=1.1)
}


Plottem <- function (i) { 
  if (i == 34) return();
  TREE <- if (i < 34) i else (i - 1)
  
  TernaryQuarts(TREE=TREE)
  title(main=paste0("\r\nQuartets"), cex.main=0.8)
  arrows(sqrt(3/4) * 0.5, 0.5, sqrt(3/4) * 0.8, 0.5, length=0.1)
  text  (sqrt(3/4) * 0.65, 0.5, pos=3, 'Decreasing resolution', cex=0.8)
  
  arrows(sqrt(3/4) * 0.98, 0.40, sqrt(3/4) * 0.98, 0.20, length=0.1)
  text  (sqrt(3/4) * 1.01, 0.30, pos=3, 'Increasing divergence', cex=0.8, srt=270)
  
  TernaryQuarts(TREE=TREE, zoom=3, padding=0.01)
  title(main=paste0("\r\nDataset ", i, ": CI=",round(clCI[i], 2)), cex.main=1.2)
  
  TernaryPlot('Same', 'Different', 'Unresolved', lab.cex=0.8,
              grid.lty='solid', col=rgb(0.9, 0.9, 0.9), grid.col='white', 
              axis.col=rgb(0.6, 0.6, 0.6), ticks.col=rgb(0.6, 0.6, 0.6),
              padding=0.1, axis.labels = round(seq(0, 20, length.out=11), 0))
  title(main="\r\nPartitions", cex.main=0.8)
  
  HorizontalGrid()
  partition_distances <- SplitsPoints(sq_trees)
  
  JoinTheDots(Split2Ternary('markov'  , TREE=TREE), col=COL_MK, pch=PCH_MK, cex=1.1)
  JoinTheDots(Split2Ternary('equal'   , TREE=TREE), col=COL_EQ, pch=PCH_EQ, cex=1.1)
  JoinTheDots(Split2Ternary('implied5', TREE=TREE), col=COL_5, pch=PCH_IW, cex=1.1)
  JoinTheDots(Split2Ternary('implied3', TREE=TREE), col=COL_3, pch=PCH_IW, cex=1.1)
  JoinTheDots(Split2Ternary('implied1', TREE=TREE), col=COL_1, pch=PCH_IW, cex=1.1)
  
  arrows(sqrt(3/4) * 0.98, 0.40, sqrt(3/4) * 0.98, 0.20, length=0.1)
  text  (sqrt(3/4) * 1.01, 0.30, pos=3, 'Increasing RF distance', cex=0.8, srt=270)
  
  AddLegend <- function(pos='bottomright')
    legend(pos, cex=0.8, bty='n',
           pch=c(PCH_MK, PCH_EQ, rep(PCH_IW, 4)), pt.cex=1.1,
           col=c(COL_MK, COL_EQ, COL_5, COL_3, COL_1),
           legend=c('Markov', 'Equal weights', paste0('Implied, k=', c(5, 3, 1)))
    )
  AddLegend()
}
```

## Trees 1--20
```{R 1-20, echo=FALSE, fig.width=9, fig.height=60}
par(mfrow=c(20, 3), mar=MARGINS)
x <- lapply(1:20, Plottem)
```

## Trees 21--40
```{R 21-40, echo=FALSE, fig.width=9, fig.height=60}
par(mfrow=c(20, 3), mar=MARGINS)
x <- lapply(21:40, Plottem)
```

## Trees 41--60
```{R 41-60, echo=FALSE, fig.width=9, fig.height=60}
par(mfrow=c(20, 3), mar=MARGINS)
x <- lapply(41:60, Plottem)
```

## Trees 61--80
```{R 61-80, echo=FALSE, fig.width=9, fig.height=60}
par(mfrow=c(20, 3), mar=MARGINS)
x <- lapply(61:80, Plottem)
```

## Trees 81--100
```{R 81-100, echo=FALSE, fig.width=9, fig.height=60}
par(mfrow=c(20, 3), mar=MARGINS)
x <- lapply(81:100, Plottem)
```

## References